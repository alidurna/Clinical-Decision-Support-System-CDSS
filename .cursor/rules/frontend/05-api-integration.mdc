---
description: API entegrasyon kurallarÄ± â€” backend iletiÅŸimi, hata yÃ¶netimi, caching, loading state (Google 2026 Standards)
globs: apps/**/*.ts,apps/**/*.tsx
alwaysApply: false
---

# ğŸ”Œ API Entegrasyon KurallarÄ±

**Versiyon:** 2.0.0 â€” Google 2026 Standards
**Ã–ncelik:** ğŸ”´ P0 â€” Kritik

---

## Genel YapÄ±

- TÃ¼m API Ã§aÄŸrÄ±larÄ± **`axios` instance** Ã¼zerinden yapÄ±lÄ±r.
- Her micro frontend kendi API katmanÄ±nÄ± `src/services/` veya `src/api/` altÄ±nda tutar.
- Base URL ortam deÄŸiÅŸkeninden alÄ±nÄ±r: `VITE_API_URL` (default: `http://localhost:8080`).
- **API Gateway** Ã¼zerinden tÃ¼m istekler yÃ¶nlendirilir.

```tsx
// src/api/client.ts
import axios from 'axios'

const apiClient = axios.create({
  baseURL: import.meta.env.VITE_API_URL || 'http://localhost:8080',
  timeout: 10000,
  headers: { 'Content-Type': 'application/json' },
})

// Interceptor â€” JWT token ekleme
apiClient.interceptors.request.use((config) => {
  const token = localStorage.getItem('token')
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})

// Interceptor â€” Hata yÃ¶netimi
apiClient.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      localStorage.removeItem('token')
      window.location.href = '/login'
    }
    return Promise.reject(error)
  }
)

export default apiClient
```

---

## Endpoint YapÄ±sÄ±

| Metod | Path | AÃ§Ä±klama |
|-------|------|----------|
| `GET` | `/api/patients` | Liste |
| `GET` | `/api/patients/:id` | Detay |
| `POST` | `/api/auth/login` | OluÅŸtur / GiriÅŸ |
| `PUT` | `/api/patients/:id` | GÃ¼ncelle |
| `DELETE` | `/api/patients/:id` | Sil |

### Kurallar
- Path: **kebab-case**, **Ã§oÄŸul** isim (`/patients`, `/doctors`).
- Versiyon: `/api/v1/...` (ileride gerektiÄŸinde).
- Query params: filtreleme, sÄ±ralama, sayfalama iÃ§in (`?page=1&limit=20&sort=name`).

---

## Ä°stek ve YanÄ±t Tipleri

- Her istek/yanÄ±t iÃ§in **TypeScript `interface`** tanÄ±mla.
- YanÄ±t wrapper'Ä± tutarlÄ± olsun:

```tsx
// âœ… DOÄRU â€” Tip gÃ¼venli API Ã§aÄŸrÄ±sÄ±
interface LoginRequest {
  email: string
  password: string
}

interface ApiResponse<T> {
  data: T
  message: string
  success: boolean
}

interface LoginResponse {
  token: string
  user: User
}

const login = async (req: LoginRequest): Promise<LoginResponse> => {
  const { data } = await apiClient.post<ApiResponse<LoginResponse>>('/api/auth/login', req)
  return data.data
}
```

---

## Hata YÃ¶netimi

Her API Ã§aÄŸrÄ±sÄ±nÄ± `try/catch` ile sar. HTTP durum kodlarÄ±na gÃ¶re farklÄ± mesajlar gÃ¶ster:

| Durum Kodu | Aksiyon | KullanÄ±cÄ± MesajÄ± |
|-----------|---------|------------------|
| 400 | Form validasyonu gÃ¶ster | "Bilgilerinizi kontrol edin" |
| 401 | Token temizle, login'e yÃ¶nlendir | "Oturum sÃ¼resi doldu" |
| 403 | Yetki uyarÄ±sÄ± gÃ¶ster | "Bu iÅŸlem iÃ§in yetkiniz yok" |
| 404 | Not found bildirimi | "Ä°stenen kayÄ±t bulunamadÄ±" |
| 409 | Conflict bildir | "Bu kayÄ±t zaten mevcut" |
| 500 | Genel hata | "Sunucu hatasÄ±, lÃ¼tfen tekrar deneyin" |
| Network | BaÄŸlantÄ± hatasÄ± | "Ä°nternet baÄŸlantÄ±nÄ±zÄ± kontrol edin" |

```tsx
const handleSubmit = async () => {
  setLoading(true)
  setError(null)
  try {
    const result = await login({ email, password })
    navigate('/dashboard')
  } catch (err) {
    if (axios.isAxiosError(err)) {
      const status = err.response?.status
      switch (status) {
        case 401: setError('E-posta veya ÅŸifre hatalÄ±.'); break
        case 403: setError('Bu iÅŸlem iÃ§in yetkiniz yok.'); break
        case 500: setError('Sunucu hatasÄ±, lÃ¼tfen tekrar deneyin.'); break
        default: setError('Bir hata oluÅŸtu.')
      }
    } else {
      setError('BaÄŸlantÄ± saÄŸlanamadÄ±.')
    }
  } finally {
    setLoading(false)
  }
}
```

---

## Loading State (ZORUNLU)

- Her API Ã§aÄŸrÄ±sÄ±nda **`loading` state** tut.
- Loading sÄ±rasÄ±nda `CircularProgress` veya `Skeleton` gÃ¶ster.
- Buton loading: **`disabled`** yap + spinner ekle.
- Ä°Ã§ iÃ§e loading: yalnÄ±zca deÄŸiÅŸen bÃ¶lÃ¼m iÃ§in gÃ¶ster (partial loading).

```tsx
const [loading, setLoading] = useState(false)
const [error, setError] = useState<string | null>(null)
const [data, setData] = useState<Patient[] | null>(null)

// Loading durumunda Skeleton gÃ¶ster
if (loading) return <Skeleton variant="rectangular" height={200} />

// Hata durumunda Alert gÃ¶ster
if (error) return <Alert severity="error">{error}</Alert>

// BoÅŸ veri durumunda Empty State
if (!data?.length) return <EmptyState message="HenÃ¼z kayÄ±t bulunmuyor" />
```

---

## Request Ä°ptal Etme (AbortController)

Uzun sÃ¼ren isteklerde veya component unmount olduÄŸunda isteÄŸi iptal et:

```tsx
useEffect(() => {
  const controller = new AbortController()
  
  const fetchPatients = async () => {
    try {
      const { data } = await apiClient.get('/api/patients', {
        signal: controller.signal
      })
      setPatients(data)
    } catch (err) {
      if (!axios.isCancel(err)) {
        setError('Veriler yÃ¼klenemedi')
      }
    }
  }
  
  fetchPatients()
  return () => controller.abort()
}, [])
```

---

## âŒ API Yasak Pratikler

1. âŒ Base URL'yi hardcode etme
2. âŒ Token'Ä± her istekte manuel ekleme (interceptor kullan)
3. âŒ API Ã§aÄŸrÄ±sÄ±nÄ± try/catch olmadan yapma
4. âŒ Loading state olmadan API Ã§aÄŸrÄ±sÄ±
5. âŒ `console.log` ile hata yÃ¶netimi
6. âŒ KullanÄ±cÄ±ya teknik hata mesajÄ± gÃ¶sterme
7. âŒ AbortController kullanmadan uzun istekler
